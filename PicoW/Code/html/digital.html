<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Digital I/O - PicoSense</title>
<style>
body{font-family:Arial;background:#f5f5f5;margin:10px;}
h1{color:#007acc;}
button{padding:5px 10px;border:none;border-radius:4px;background:#007acc;color:#fff;cursor:pointer;}
button:hover{background:#005fa3;}
.section{background:#fff;padding:10px;border-radius:6px;box-shadow:0 1px 3px rgba(0,0,0,.1);}
</style>
</head>
<body>
<h1>Digital I/O</h1>
<div class="section">
<h3>Inputs</h3>
DIN0: <span id="i0">--</span><br>
DIN1: <span id="i1">--</span><br>

<h3>Outputs</h3>
DOUT0: <span id="o0">--</span>
<button onclick="setOut(0,1)">ON</button>
<button onclick="setOut(0,0)">OFF</button><br>
DOUT1: <span id="o1">--</span>
<button onclick="setOut(1,1)">ON</button>
<button onclick="setOut(1,0)">OFF</button>
</div>

<button onclick="location.href='/'">Back to Dashboard</button>

<script>
document.addEventListener("DOMContentLoaded", function(){

    async function fetchDigital(){
        try {
            let res = await fetch('/digital');
            let data = await res.json();
            document.getElementById('i0').textContent = data.i0;
            document.getElementById('i1').textContent = data.i1;
            document.getElementById('o0').textContent = data.o0;
            document.getElementById('o1').textContent = data.o1;
        } catch(e){
            console.log("Failed to fetch digital data", e);
        }
    }

    async function setOut(idx, val){
        try {
            await fetch(`/digital?out${idx}=${val}`);
            await fetchDigital();
        } catch(e){
            console.log("Failed to set output", e);
        }
    }

    // Attach buttons to global for onclick access
    window.setOut = setOut;

    // Auto-refresh
    fetchDigital();
    setInterval(fetchDigital, 1500);

});
</script>
</body>
</html>
